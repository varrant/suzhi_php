<!-- 登陆 -->
<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>登陆</title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <link rel="stylesheet" href="assets/css/amazeui.css">
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/login.css">
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/amazeui.min.js"></script>
  <script src="js/function.js"></script>
</head>
<body>
<div class="logo">
	
</div>
<div id="app">
    <div class="ipt_box">
    	<input type="text" v-model="loginModel.phone" class="ipt_username" placeholder="请输入需要绑定的手机号">
    </div>
    <div class="ipt_box">
    	<input type="text" v-model="loginModel.code" class="ipt_username" placeholder="请输入验证码">
    	<div class="ipt_sendCode" @click="sendSms($event)">获取验证码</div>
    </div>

    <div class="margin_box180"></div>
    <div class="btn_box">
    	<button class="btn_login_out" id="btn_login" disabled="disabled" @click="login">登录</button>
    </div>
    <div class="btn_box">
      <button class="btn_login_out" onclick="window.location.href='register.html'">立即注册</button>
    </div>
</div>
<!-- 提示框架 -->
<div id="rb1" class="remindbox">
  <div class="icon"><i class="fa fa-exclamation-circle" aria-hidden="true"></i></div>
  <div class="content"></div>
</div>
</body>
<script src="js/vue.js"></script>
<script>
	function getcode(t){
    $(t).html("重新发送");
		$("#btn_login").attr("class","btn_login_over");
    $("#btn_login").removeAttr("disabled");
	}
/*  function login(){
    showRemindbox("手机号格式错误，请重新输入");
  }*/

  function showRemindbox(content){
    $("#rb1").slideToggle();
    $("#rb1").find(".content").html(content);
    $("#rb1").unbind("click");
    $("#rb1").bind("click",function(){
      $("#rb1").slideToggle();
    })
  }
  var login = new Vue({
      el:'#app',
      data:{
        loginUrl: 'http://suzhi.hzjuym.com/index.php/home/Login/dologin',
        sendSmsUrl: 'http://suzhi.hzjuym.com/index.php/home/Register/Sensms',
        loginModel: {
          phone: '',
          code: '',
          login:'login'
        }
      },
      methods:{
          login: function(){
            var vm = this
            var phone = this.loginModel.phone;
            var code = this.loginModel.code;

            if(phone == "" || phone == null){
              showRemindbox("手机号不能为空！");
              return;
            }
            if(code == "" || code == null){
              showRemindbox("验证码不能为空！");
              return;
            }
            $.ajax({
              url: vm.loginUrl,
              type: 'POST',
              dataType: 'json',
              data: vm.loginModel,
              success: function(data) {
                console.log(data);
                if(data == 'ok'){
                  //vm.msg = '登录成功！'
                  showRemindbox("登录成功！");
                  vm.phone = phone;
                  setCookie("phone",phone);
                  window.location.href = "tasklist.html";
                }else{
                  showRemindbox("该手机号不存在，请注册后登陆！");
                }
               
                
              },
              error: function(e){
                //console.log(e);
               showRemindbox("连接失败！");
              }
            })
          },
          sendSms:function(event){
            var vm = this;
            var phone = this.loginModel.phone;
            var code = this.loginModel.code;
            if(phone == "" || phone == null){
              showRemindbox("手机号不能为空！");
              return;
            }else{
                $.ajax({
                url: vm.sendSmsUrl,
                type: 'POST',
                dataType: 'json',
                data: vm.loginModel,
                success: function(data) {
                  if(data == 'ok'){
                    showRemindbox("短信已发送！");
                  }else if(data == 'error'){
                    showRemindbox("发送失败！");
                  }                 

                },
                error: function(e){
                 showRemindbox("连接失败！");
                }
              })
            }
            getcode(event.currentTarget);
          }
      }
  })
  
</script>
</html>
